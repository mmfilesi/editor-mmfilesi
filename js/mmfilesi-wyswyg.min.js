!function(a,b,c){function d(b,c){this.element=b,this.options=a.extend({},f,c),this.name=e,this.init()}var e="editorMM",f={style:{bgPrimary:"ccc",textPrimary:"000",width:"800px",height:"100%"},buttons:["colors","colors-bk","sep","bold","italic","underline","strikeThrough","smallCaps","subscript","superscript","header","sep","insertUnorderedList","insertOrderedList","sep","code","br","justifyLeft","justifyCenter","justifyRight","justifyFull","sep","link","unlink","sep","img","filmstrip","sep","smile","sep","undo","redo","removeFormat"],colors:["000000","404040","636363","808080","A0A0A0","C0C0C0","E0E0E0","FFFFFF","660033","99004C","CC0066","FF007F","FF3399","FF66B2","FF99CC","FFCCE5","660066","990099","CC00CC","FF00FF","FF33FF","FF66FF","FF99FF","FFCCCC","330066","4C0099","6600CC","7F00FF","9933FF","B266FF","CC99FF","E5CCFF","000066","000099","0000CC","0000FF","3333FF","6666FF","9999FF","CCCCFF","003366","004C99","0055CC","0080FF","3399FF","66B2FF","99CCFF","CCE5FF","006666","009999","00CCCC","00FFFF","33FF99","66FFB2","99FFCC","CCFFE5","006600","009900","00CC00","00FF00","99FF33","B2FF66","CCFF99","E5FFCC","336600","4C9900","66CC00","999900","CCCC00","FFFF00","FFFF99","FFFFCC","663300","994C00","CC6600","FF8000","FF9933","FFB266","FFCC99","FFE5CC","660000","990000","CC0000","FF0000","FF3333","FF6666","FF9999","FFCCCC"],lang:"eng"},g={es:{colors:"colores","colors-bk":"color de fondo",bold:"negrita",italic:"cursiva",underline:"subrayado",smallCaps:"versalitas",strikeThrough:"tachado",header:"encabezados",subscript:"subíndice",superscript:"superíndice",justifyLeft:"izquierda",justifyCenter:"centrado",justifyRight:"derecha",justifyFull:"justfificado",insertOrderedList:"lista ordenada",insertUnorderedList:"lista desordenada",table:"tabla",link:"enlace",unlink:"quitar enlace",img:"imagen",filmstrip:"audiovisual",smile:"emoticono",div:"separador",removeFormat:"borrar estilos",undo:"deshacer",redo:"rehacer",code:"código",paragraph:"párrafo",route:"ruta",height:"alto",width:"ancho",responsive:"responsive",options:"opciones",caption:"leyenda",align:"alinear",done:"aceptar",moreFormats:"formatos adicionales (separados por comas)"},eng:{colors:"colors","colors-bk":"background color",bold:"bold",italic:"italic",underline:"underline",smallCaps:"small caps",strikeThrough:"strike through",header:"headers",subscript:"subscript",superscript:"superscript",justifyLeft:"justify left",justifyCenter:"justify center",justifyRight:"justify right",justifyFull:"justify full",insertOrderedList:"insert ordered list",insertUnorderedList:"insert unordered list",table:"table",link:"link",unlink:"unlink",img:"picture",filmstrip:"video",smile:"smile",div:"sep",removeFormat:"remove format",undo:"undo",redo:"redo",code:"code",paragraph:"paragraph",route:"route",height:"height",width:"width",responsive:"responsive",options:"options",caption:"caption",align:"align",done:"done",moreFormats:"moreFormats"}};d.prototype={init:function(){this.options.buttons=this.toolbarOptions(this.options),this.toolbarInsert(this.element,this.options),this.toolbarBind(this.element,this.options),this.generalBind(this.element,this.options)},toolbarOptions:function(a){for(var b=[],c=0,d=a.buttons.length;d>c;c++)b.push({action:a.buttons[c],title:g[a.lang][a.buttons[c]]});return b},toolbarInsert:function(b,c){var d="",e="";d+="<div class='toolbar' style='width:"+c.style.width+"'>";for(var f=0,h=c.buttons.length;h>f;f++)if("sep"!=c.buttons[f].action&&"br"!=c.buttons[f].action){if(d+="<button class='buttonsToolbar js-buttons' title='"+c.buttons[f].title+"' id='js-"+c.buttons[f].action+"' data-type='"+c.buttons[f].action+"'>",d+="<span class='icon-"+c.buttons[f].action+"'></span>",d+="</button>","header"==c.buttons[f].action){d+="<div class='toolbarCommonPanel headerPanel'><ul>";for(var i=0;7>i;i++)d+="<li class='js-optionHeader' data-header='"+(i+1)+"' style='font-size:"+(18-i)+"px'>",d+=c.buttons[f].title+" "+(i+1),d+="</li>";d+="</ul><p class='js-optionHeader' data-header='par'>"+g[c.lang].paragraph+"</p></div>"}else if("link"==c.buttons[f].action)d+="<div class='toolbarCommonPanel linkPanel'>",d+="<input type='text' class='inputsToolbar inputWithIcon js-inputLink' placeholder='www.url.com'>",d+="<span class='iconInput success icon-success submitLink'></span>",d+="</div>";else if("img"==c.buttons[f].action)d+="<div class='toolbarCommonPanel imgPanel'>",d+="<p><input type='text' name='js-inputRoute' class='inputsToolbar js-inputRoute inputLin' placeholder=''><label for='js-inputRoute'>"+g[c.lang].route+"</label></p>",d+="<p><input type='text' name='js-inputWidth' class='inputsToolbar js-inputWidth inputLin' placeholder='ie, 100px / 100%'><label for='js-inputWidth'>"+g[c.lang].width+"</label></p>",d+="<p><input type='text' class='inputsToolbar js-inputHeight inputLin' placeholder='ie, 100px / 100%'><label for='js-inputWidth'>"+g[c.lang].height+"</label></p>",d+="<p><input type='checkbox' class='js-inputResponsive'> "+g[c.lang].responsive+"</p>",d+="<p class='moreOptions'>+</p>",d+="<div class='imgSuboptions' style='display:none;'>",d+="<p><input type='text' name='js-inputAlt' class='inputsToolbar js-inputAlt inputLin' placeholder=''><label for='js-inputAlt'>alt</label></p>",d+="<p><input type='text' name='js-inputTitle' class='inputsToolbar js-inputTitle inputLin' placeholder=''><label for='js-inputTitle'>title</label></p>",d+="<p><input type='text' class='inputsToolbar js-inputCaption inputLin' placeholder=''><label for='js-inputCaption'>"+g[c.lang].caption+"</label></p>",d+="<p><label>"+g[c.lang].align+"</label><span class='checkIcon icon-justifyLeft js-alignImg' data-float='left'></span><span class='checkIcon icon-justifyCenter js-alignImg' data-float='center'></span><span class='checkIcon roundButton icon-justifyRight js-alignImg' data-float='right'></span></p>",d+="</div>",d+="<p style='text-align:center;' class='js-submitImg'><button class='buttonDone'>"+g[c.lang].done+"</button></p>",d+="</div>";else if("filmstrip"==c.buttons[f].action)d+="<div class='toolbarCommonPanel videoPanel'>",d+="<p><input type='text' name='js-inputRoute' class='inputsToolbar js-inputRoute inputLin' placeholder=''><label for='js-inputRoute'>"+g[c.lang].route+"</label></p>",d+="<p><input type='text' name='js-inputWidth' class='inputsToolbar js-inputWidth inputLin' placeholder='ie, 100px / 100%'><label for='js-inputWidth'>"+g[c.lang].width+"</label></p>",d+="<p><input type='text' class='inputsToolbar js-inputHeight inputLin' placeholder='ie, 100px / 100%'><label for='js-inputWidth'>"+g[c.lang].height+"</label></p>",d+="<p><input type='checkbox' class='js-inputResponsive'> "+g[c.lang].responsive+"</p>",d+="<p class='moreOptions'>+</p>",d+="<div class='js-videoSuboptions' style='display:none;'>",d+="<p>"+g[c.lang].moreFormats+"</p>",d+="<p><input type='text' name='js-inputFormats' class='inputsToolbar js-inputFormats inputLin' placeholder='ie: webm, mp4, ogg'></p>",d+="<p><label>"+g[c.lang].align+"</label><span class='checkIcon icon-justifyLeft js-alignVideo' data-float='left'></span><span class='checkIcon icon-justifyCenter js-alignVideo' data-float='center'></span><span class='checkIcon roundButton icon-justifyRight js-alignVideo' data-float='right'></span></p>",d+="</div>",d+="<p style='text-align:center;' class='js-submitVideo'><button class='buttonDone'>"+g[c.lang].done+"</button></p>",d+="</div>";else if("smile"==c.buttons[f].action){d+="<div class='toolbarCommonPanel smilePanel'>";for(var j=0;39>j;j++)d+="<img src='icons/"+j+".png' width='24' height='24' class='js-smile'>";d+="</div>"}else if("colors"==c.buttons[f].action){d+="<div class='toolbarCommonPanel colorsPanel'>";for(var k=0,l=c.colors.length;l>k;k++)d+="<div class='colorsTile js-optionColor' style='background:#"+c.colors[k]+"' data-color="+c.colors[k]+"></div>";d+="</div>"}else if("colors-bk"==c.buttons[f].action){d+="<div class='toolbarCommonPanel colorsPanel'>";for(var k=0,l=c.colors.length;l>k;k++)d+="<div class='colorsTile js-optionColor' style='background:#"+c.colors[k]+"' data-color="+c.colors[k]+"></div>";d+="</div>"}}else d+="br"==c.buttons[f].action?"<br>":"<div class='buttonsToolbarSep'></div>";d+="</div>",e="<div id='editor-mm' class='editor-mm' contenteditable='true' style='width:"+c.style.width+"'>"+a(b).val()+"</div>",a(b).before(d+e).hide(),d=e=null},toolbarBind:function(b){var d=this;a(".js-buttons").mousedown(function(e){switch(e.preventDefault(),this.action=a(this).attr("data-type"),this.action){case"bold":case"italic":case"underline":case"strikeThrough":case"subscript":case"superscript":case"justifyCenter":case"justifyRight":case"justifyLeft":case"justifyFull":case"insertUnorderedList":case"insertOrderedList":case"removeFormat":case"undo":case"redo":case"unlink":c.execCommand(this.action,!1,null);break;case"link":d.linkButton(a(this));break;case"colors-bk":d.bkcolorButton(a(this));break;case"colors":d.colorButton(a(this));break;case"smallCaps":d.nodeButton("span","font-variant:small-caps;");break;case"header":d.headerButton(a(this));break;case"img":d.imgButton(a(this));break;case"filmstrip":d.videoButton(a(this));break;case"smile":d.smileButton(a(this));break;case"code":d.showCodeButton(b)}})},nodeButton:function(a,b){var d,e,f,b=b||"withoutStyle";d=this.getSelection(),"None"!=d.type&&d.isCollapsed===!1&&(f=c.createElement(a),"withoutStyle"!=b&&(f.style.cssText=b),e=d.getRangeAt(0),documentFragment=e.extractContents(),f.appendChild(documentFragment),e.insertNode(f),d.removeAllRanges())},headerButton:function(b){function d(){f.slideUp(600),b.removeClass("js-active"),a(".js-optionHeader").unbind("click"),b=f=g=h=i=j=null}var e=this,f=b.next(".headerPanel"),g=f.find(".js-optionHeader"),h=null,i=null,j=null;h=e.getSelection(),"None"!=h.type&&h.isCollapsed===!1&&(j=h.getRangeAt(0)),b.hasClass("js-active")?d():(f.css("left",a("#js-header").offset().left).slideDown(600),b.addClass("js-active"),g.click(function(){null!==j&&(e.restoreSelection(j),"par"!=a(this).attr("data-header")?e.nodeButton("h"+a(this).attr("data-header")):c.execCommand("formatBlock",!1,"p")),d()}))},linkButton:function(a){function b(){e.slideUp(600),g.unbind("click"),a.removeClass("js-active"),f.val(""),a=e=f=g=h=i=j=null}var d=this,e=a.next(".linkPanel"),f=e.find(".js-inputLink"),g=e.find(".submitLink"),h=null,i=null,j=null;i=d.getSelection(),"None"!=i.type&&i.isCollapsed===!1&&(h=i.getRangeAt(0)),a.hasClass("js-active")?(b(),a.removeClass("js-active")):(a.addClass("js-active"),e.css("left",a.position().left).slideDown(600),g.click(function(){null!==h&&(d.restoreSelection(h),j=f.val().trim().toLowerCase(),j=-1==j.indexOf("http://")&&-1==j.indexOf("https://")?"http://"+j:j,c.execCommand("createLink",!1,j)),b()}))},videoButton:function(b){function c(){e.slideUp(600).removeClass("js-active"),b.removeClass("js-active"),i.unbind("click").prop("checked",!1),l.unbind("click").text("+"),m.unbind("click"),k.unbind("click"),f.val(""),g.val(""),h.val(""),j.val(""),n.css("display","none"),k.removeClass("js-active").removeClass("success"),o=p=selRang=r=null}var d=this,e=b.next(".videoPanel"),f=e.find(".js-inputRoute"),g=e.find(".js-inputHeight"),h=e.find(".js-inputWidth"),i=e.find(".js-inputResponsive"),j=e.find(".js-inputFormats"),k=e.find(".js-alignVideo"),l=e.find(".moreOptions"),m=e.find(".js-submitVideo"),n=e.find(".js-videoSuboptions"),o=null,p=null,q=null,r=null;o=d.getSelection(),"None"!=o.type&&(q=o.getRangeAt(0)),b.hasClass("js-active")?c():(e.css("left",b.position().left).slideDown(600),b.addClass("js-active"),i.click(function(){a(this).prop("checked")&&(h.val("100%"),g.val("auto"))}),l.click(function(){a(this).hasClass("js-active")?n.slideUp("fast",function(){l.text("+").removeClass("js-active")}):n.slideDown("fast",function(){l.text("-").addClass("js-active")})}),k.click(function(){a(this).hasClass("js-active")?a(this).removeClass("js-active").removeClass("success"):(k.removeClass("js-active").removeClass("success"),a(this).addClass("js-active").addClass("success"))}),m.click(function(){var a,b;if(null!==q&&(d.restoreSelection(q),a=n.find(".js-active").attr("data-float"),a="left"==a?"style='float:left;'":"right"==a?"style='float:right;'":"center"==a?"style='margin: 0 auto; text-align:center;'":"",b=f.val(),b&&-1!=b.indexOf("."))){if(b=b.split(".").pop(),r="<video width='"+h.val()+"' height='"+g.val()+"' controls "+a+">",r+="<source src='"+f.val()+"' type='video/"+b+"'>",j.val()){a=j.val().split(",");for(var e=0,i=a.length;i>e;e++)a[e]!=b&&(r+="<source src='"+f.val().replace(b,a[e].trim())+"' type='video/"+a[e].trim()+"'>")}r+="Your browser does not support the video tag.",r+="</video>",d.insertHtmlAfterSelection(r)}c()}))},imgButton:function(b){function c(){e.slideUp(600).removeClass("js-active"),b.removeClass("js-active"),i.unbind("click").prop("checked",!1),n.unbind("click").text("+"),o.unbind("click"),m.unbind("click"),f.val(""),g.val(""),h.val(""),j.val(""),k.val(""),l.val(""),p.css("display","none"),m.removeClass("js-active").removeClass("success"),q=r=selRang=t=null}var d=this,e=b.next(".imgPanel"),f=e.find(".js-inputRoute"),g=e.find(".js-inputHeight"),h=e.find(".js-inputWidth"),i=e.find(".js-inputResponsive"),j=e.find(".js-inputAlt"),k=e.find(".js-inputTitle"),l=e.find(".js-inputCaption"),m=e.find(".js-alignImg"),n=e.find(".moreOptions"),o=e.find(".js-submitImg"),p=e.find(".imgSuboptions"),q=null,r=null,s=null,t=null;q=d.getSelection(),"None"!=q.type&&(s=q.getRangeAt(0)),b.hasClass("js-active")?c():(e.css("left",b.position().left).slideDown(600),b.addClass("js-active"),i.click(function(){a(this).prop("checked")&&(h.val("100%"),g.val("auto"))}),n.click(function(){a(this).hasClass("js-active")?p.slideUp("fast",function(){n.text("+").removeClass("js-active")}):p.slideDown("fast",function(){n.text("-").addClass("js-active")})}),m.click(function(){a(this).hasClass("js-active")?a(this).removeClass("js-active").removeClass("success"):(m.removeClass("js-active").removeClass("success"),a(this).addClass("js-active").addClass("success"))}),o.click(function(){var a;null!==s&&(d.restoreSelection(s),a=p.find(".js-active").attr("data-float"),a="left"==a?"style='float:left;'":"right"==a?"style='float:right;'":"center"==a?"style='margin: 0 auto; text-align:center;'":"",t="<figure "+a+">",t+="<img src='"+f.val()+"' width='"+h.val()+"' height='"+g.val()+"' alt='"+j.val()+"' title='"+k.val()+"'>",""!=l.val()&&(t+="<figcaption>"+l.val()+"</figcaption>"),t+="</figure>",d.insertHtmlAfterSelection(t)),c()}))},smileButton:function(b){function c(){e.slideUp(600),b.removeClass("js-active"),a(".js-smile").unbind("click"),f=g=h=i=null}var d=this,e=b.next(".smilePanel"),f=null,g=null,h=null,i=null;g=d.getSelection(),"None"!=g.type&&(f=g.getRangeAt(0)),b.hasClass("js-active")?c():(e.css("left",b.position().left).slideDown(600),b.addClass("js-active"),a(".js-smile").click(function(){null!==f&&(d.restoreSelection(f),i=a(this)[0].src,h=new Image(24,24),h.src=i,h.style.verticalAlign="bottom",f.insertNode(h)),c()}))},colorButton:function(b){function d(){f.slideUp(600),b.removeClass("js-active"),g.unbind("click"),f=g=h=i=j}var e=this,f=b.next(".colorsPanel"),g=f.find(".js-optionColor"),h=null,i=null,j=null;h=e.getSelection(),"None"!=h.type&&(j=h.getRangeAt(0)),b.hasClass("js-active")?d():(f.css("left",b.position().left).slideDown(600),b.addClass("js-active"),g.click(function(){null!==j&&(e.restoreSelection(j),c.execCommand("styleWithCSS",!1,!0),c.execCommand("foreColor",!1,"#"+a(this).attr("data-color"))),d()}))},bkcolorButton:function(b){function d(){f.slideUp(600),b.removeClass("js-active"),g.unbind("click"),f=g=h=i=j}var e=this,f=b.next(".colorsPanel"),g=f.find(".js-optionColor"),h=null,i=null,j=null;h=e.getSelection(),"None"!=h.type&&(j=h.getRangeAt(0)),b.hasClass("js-active")?d():(f.css("left",b.position().left).slideDown(600),b.addClass("js-active"),g.click(function(){null!==j&&(e.restoreSelection(j),c.execCommand("backColor",!1,"#"+a(this).attr("data-color"))),d()}))},showCodeButton:function(b){var c=a(b),d=c.prev(".editor-mm");c.css("width",d.css("width")).css("height",d.css("height")).css("box-sizing","border-box"),a("#js-code").unbind("mousedown"),a("#js-code").click(function(){a(this).toggleClass("js-active"),a(this).hasClass("js-active")?(c.val(d.html()).css("display","block"),d.css("display","none"),a(".js-buttons").addClass("buttonDisabled"),a(this).removeClass("buttonDisabled")):(c.css("display","none"),d.html(c.val()).css("display","block"),a(".js-buttons").removeClass("buttonDisabled"))})},getSelection:function(){return b.getSelection?b.getSelection():c.selection.createRange?c.selection.createRange():void 0},restoreSelection:function(a){var d=b.getSelection();if(a){try{d.removeAllRanges()}catch(e){c.body.createTextRange().select(),c.selection.empty()}d.addRange(a)}},insertHtmlAfterSelection:function(a){var d,e,f,g;if(b.getSelection){if(d=b.getSelection(),d.getRangeAt&&d.rangeCount){e=b.getSelection().getRangeAt(0),f=e.cloneRange(),e.collapse(!1);var h=c.createElement("div");h.innerHTML=a;for(var g,i,j=c.createDocumentFragment();g=h.firstChild;)i=j.appendChild(g);e.insertNode(j),i&&(f.setEndAfter(i),d.removeAllRanges(),d.addRange(f))}}else c.selection&&c.selection.createRange&&(e=c.selection.createRange(),f=e.duplicate(),e.collapse(!1),e.pasteHTML(a),f.setEndPoint("EndToEnd",e),f.select())},generalBind:function(b){var c=a(b),d=c.prev(".editor-mm");d.blur(function(){c.val(d.html())}),a(".js-buttons").click(function(a){a.preventDefault(),a.stopPropagation()})}},a.fn[e]=function(b){return this.each(function(){a.data(this,"pEditorMM")||a.data(this,"pEditorMM",new d(this,b))})}}(jQuery,window,document);